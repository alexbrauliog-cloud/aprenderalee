<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprender a Leer</title>
    <!-- Incluye el CDN de Tailwind CSS para un estilo r√°pido y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo para que la aplicaci√≥n ocupe toda la pantalla y sea un lienzo de juego */
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        /* Oculta las pantallas por defecto */
        .content-screen {
            display: none;
        }

        .content-screen.active {
            display: flex;
        }

        /* Oculta los botones en la pantalla de inicio */
        #home-screen.active .nav-button {
            display: none;
        }
    </style>
</head>
<body class="bg-black text-white flex flex-col items-center justify-center h-full">

    <!-- Contenedor principal de la aplicaci√≥n -->
    <div id="app-container" class="relative w-full h-full flex flex-col items-center justify-center">

        <!-- Pantalla de Inicio -->
        <div id="home-screen" class="content-screen active flex-col items-center justify-center transition-all duration-300">
            <h1 class="text-4xl sm:text-6xl font-extrabold tracking-tight">Aprender a leer</h1>
            <button onclick="navigate(1)" class="mt-8 px-8 py-4 bg-green-500 text-white rounded-full font-bold shadow-lg transition-transform transform hover:scale-105 active:scale-95">
                Empezar
            </button>
        </div>

        <!-- Pantalla de Contenido (letras y s√≠labas) -->
        <div id="content-screen" class="content-screen flex-col items-center justify-center transition-all duration-300">
            <!-- Emoji o imagen (ahora en la parte superior) -->
            <div id="display-emoji" class="text-[12rem] mb-4 select-none">‚úàÔ∏è</div>
            <!-- Texto descriptivo -->
            <p id="description-text" class="text-3xl font-semibold text-center mt-4">A de Avi√≥n</p>
            <!-- Letra o s√≠laba (ahora en la parte inferior) -->
            <h2 id="display-text" class="text-9xl font-black mb-8 select-none">A</h2>
        </div>

        <!-- Botones de navegaci√≥n (ocultos en la pantalla de inicio) -->
        <div class="fixed bottom-0 w-full p-4 flex justify-between items-center transition-opacity duration-300" id="nav-buttons-container">
            <!-- Bot√≥n de retroceder -->
            <button id="prev-button" onclick="navigate(-1)" class="p-4 bg-purple-500 text-white rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95">
                <span class="text-3xl">‚¨ÖÔ∏è</span>
            </button>
            <!-- Bot√≥n de avanzar -->
            <button id="next-button" onclick="navigate(1)" class="p-4 bg-purple-500 text-white rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95">
                <span class="text-3xl">‚û°Ô∏è</span>
            </button>
        </div>
        
        <!-- Bot√≥n de audio (ahora en la esquina superior derecha) -->
        <button id="audio-button" class="fixed top-4 right-4 p-6 bg-blue-500 rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95 flex items-center justify-center opacity-0" disabled>
            <span id="audio-icon" class="text-3xl">üîä</span>
            <span id="audio-loading" class="hidden text-sm ml-2">Cargando...</span>
        </button>

    </div>

    <script>
        // Array de datos con el contenido de cada pantalla.
        const contentData = [
            // Vocales
            { letter: 'A', emoji: '‚úàÔ∏è', description: 'A de Avi√≥n', bgColor: 'bg-indigo-600' },
            { letter: 'E', emoji: 'üêò', description: 'E de Elefante', bgColor: 'bg-teal-600' },
            { letter: 'I', emoji: 'üèùÔ∏è', description: 'I de Isla', bgColor: 'bg-rose-600' },
            { letter: 'O', emoji: 'üêª', description: 'O de Oso', bgColor: 'bg-orange-600' },
            { letter: 'U', emoji: 'üçá', description: 'U de Uvas', bgColor: 'bg-emerald-600' },
            // Consonantes
            { letter: 'B', emoji: 'üê≥', description: 'B de Ballena', bgColor: 'bg-pink-600' },
            { letter: 'C', emoji: 'üêá', description: 'C de Conejo', bgColor: 'bg-fuchsia-600' },
            { letter: 'D', emoji: 'üê¨', description: 'D de Delf√≠n', bgColor: 'bg-lime-600' },
            { letter: 'F', emoji: 'ü¶≠', description: 'F de Foca', bgColor: 'bg-cyan-600' },
            { letter: 'G', emoji: 'üêà', description: 'G de Gato', bgColor: 'bg-orange-600' },
            { letter: 'H', emoji: 'üç¶', description: 'H de Helado', bgColor: 'bg-purple-600' },
            { letter: 'J', emoji: 'ü¶í', description: 'J de Jirafa', bgColor: 'bg-teal-600' },
            { letter: 'K', emoji: 'üê®', description: 'K de Koala', bgColor: 'bg-pink-600' },
            { letter: 'L', emoji: 'ü¶Å', description: 'L de Le√≥n', bgColor: 'bg-lime-600' },
            { letter: 'M', emoji: 'üêí', description: 'M de Mono', bgColor: 'bg-rose-600' },
            { letter: 'N', emoji: 'üçä', description: 'N de Naranja', bgColor: 'bg-amber-600' },
            { letter: '√ë', emoji: 'ü¶©', description: '√ë de √ëand√∫', bgColor: 'bg-fuchsia-600' },
            { letter: 'P', emoji: 'üêï', description: 'P de Perro', bgColor: 'bg-indigo-600' },
            { letter: 'Q', emoji: 'üßÄ', description: 'Q de Queso', bgColor: 'bg-cyan-600' },
            { letter: 'R', emoji: 'üê≠', description: 'R de Rat√≥n', bgColor: 'bg-emerald-600' },
            { letter: 'S', emoji: '‚òÄÔ∏è', description: 'S de Sol', bgColor: 'bg-yellow-600' },
            { letter: 'T', emoji: 'üêÖ', description: 'T de Tigre', bgColor: 'bg-rose-600' },
            { letter: 'V', emoji: 'üêÑ', description: 'V de Vaca', bgColor: 'bg-teal-600' },
            { letter: 'W', emoji: 'ü¶°', description: 'W de Wombat', bgColor: 'bg-indigo-600' },
            { letter: 'X', emoji: 'üéπ', description: 'X de Xil√≥fono', bgColor: 'bg-amber-600' },
            { letter: 'Y', emoji: 'ü™Ä', description: 'Y de Yoyo', bgColor: 'bg-purple-600' },
            { letter: 'Z', emoji: 'ü¶ä', description: 'Z de Zorro', bgColor: 'bg-lime-600' },
            // S√≠labas
            { letter: 'MA', emoji: 'üçé', description: 'MA de Manzana', bgColor: 'bg-red-600' },
            { letter: 'ME', emoji: 'ü™ë', description: 'ME de Mesa', bgColor: 'bg-blue-600' },
            { letter: 'MI', emoji: 'üé§', description: 'MI de Micr√≥fono', bgColor: 'bg-yellow-600' },
            { letter: 'MO', emoji: 'üõµ', description: 'MO de Moto', bgColor: 'bg-pink-600' },
            { letter: 'MU', emoji: 'ü¶á', description: 'MU de Murci√©lago', bgColor: 'bg-gray-600' },
            { letter: 'PA', emoji: 'ü¶Ü', description: 'PA de Pato', bgColor: 'bg-sky-600' },
            { letter: 'PE', emoji: '‚öΩ', description: 'PE de Pelota', bgColor: 'bg-green-600' },
            { letter: 'PI', emoji: 'üå≤', description: 'PI de Pino', bgColor: 'bg-lime-600' },
            { letter: 'PO', emoji: 'üêî', description: 'PO de Pollo', bgColor: 'bg-amber-600' },
            { letter: 'PU', emoji: 'üö™', description: 'PU de Puerta', bgColor: 'bg-purple-600' },
            { letter: 'LA', emoji: '‚úèÔ∏è', description: 'LA de L√°piz', bgColor: 'bg-orange-600' },
            { letter: 'LE', emoji: 'ü•õ', description: 'LE de Leche', bgColor: 'bg-indigo-600' },
            { letter: 'LI', emoji: 'üìñ', description: 'LI de Libro', bgColor: 'bg-fuchsia-600' },
            { letter: 'LO', emoji: 'ü¶ú', description: 'LO de Loro', bgColor: 'bg-teal-600' },
            { letter: 'LU', emoji: 'üåô', description: 'LU de Luna', bgColor: 'bg-slate-600' },
            { letter: 'SA', emoji: 'üçâ', description: 'SA de Sand√≠a', bgColor: 'bg-red-600' },
            { letter: 'SE', emoji: 'üö¶', description: 'SE de Semaforo', bgColor: 'bg-amber-600' },
            { letter: 'SI', emoji: 'ü™ë', description: 'SI de Silla', bgColor: 'bg-lime-600' },
            { letter: 'SO', emoji: '‚òÄÔ∏è', description: 'SO de Sol', bgColor: 'bg-yellow-600' },
            { letter: 'SU', emoji: '‚ûï', description: 'SU de Sumar', bgColor: 'bg-indigo-600' },
            { letter: 'TA', emoji: '‚òï', description: 'TA de Tasa', bgColor: 'bg-rose-600' },
            { letter: 'TE', emoji: 'üìû', description: 'TE de Tel√©fono', bgColor: 'bg-cyan-600' },
            { letter: 'TI', emoji: 'ü¶à', description: 'TI de Tibur√≥n', bgColor: 'bg-blue-600' },
            { letter: 'TO', emoji: 'üêÇ', description: 'TO de Toro', bgColor: 'bg-green-600' },
            { letter: 'TU', emoji: 'üö∞', description: 'TU de Tubo', bgColor: 'bg-orange-600' },
            { letter: 'BA', emoji: '‚õµ', description: 'BA de Barco', bgColor: 'bg-sky-600' },
            { letter: 'BO', emoji: 'üçæ', description: 'BO de Botella', bgColor: 'bg-emerald-600' },
            { letter: 'CA', emoji: 'üè†', description: 'CA de Casa', bgColor: 'bg-fuchsia-600' },
            { letter: 'CO', emoji: 'üêá', description: 'CO de Conejo', bgColor: 'bg-purple-600' },
            { letter: 'DA', emoji: 'üé≤', description: 'DA de Dado', bgColor: 'bg-pink-600' },
            { letter: 'DE', emoji: 'üëâ', description: 'DE de Dedo', bgColor: 'bg-teal-600' },
            { letter: 'GA', emoji: 'üêà', description: 'GA de Gato', bgColor: 'bg-rose-600' },
            { letter: 'GO', emoji: 'üß¢', description: 'GO de Gorra', bgColor: 'bg-yellow-600' },
            { letter: 'NA', emoji: 'üçä', description: 'NA de Naranja', bgColor: 'bg-amber-600' },
            { letter: 'NE', emoji: 'üë∂', description: 'NE de Nene', bgColor: 'bg-cyan-600' },
            { letter: 'FA', emoji: 'üëª', description: 'FA de Fantasma', bgColor: 'bg-indigo-600' },
            { letter: 'FE', emoji: 'üé†', description: 'FE de Feria', bgColor: 'bg-lime-600' },
            { letter: 'JA', emoji: 'üè∫', description: 'JA de Jarra', bgColor: 'bg-blue-600' },
            { letter: 'JO', emoji: 'üíé', description: 'JO de Joya', bgColor: 'bg-green-600' },
            { letter: 'RA', emoji: 'üê∏', description: 'RA de Rana', bgColor: 'bg-red-600' },
            { letter: 'RO', emoji: 'üåπ', description: 'RO de Rosa', bgColor: 'bg-pink-600' }
        ];

        let currentIndex = 0;
        const homeScreen = document.getElementById('home-screen');
        const contentScreen = document.getElementById('content-screen');
        const navButtonsContainer = document.getElementById('nav-buttons-container');
        const audioButtonContainer = document.getElementById('audio-button');
        const displayText = document.getElementById('display-text');
        const displayEmoji = document.getElementById('display-emoji');
        const descriptionText = document.getElementById('description-text');
        const audioIcon = document.getElementById('audio-icon');
        const audioLoading = document.getElementById('audio-loading');
        const appContainer = document.getElementById('app-container');

        // Funci√≥n para actualizar la UI con el contenido del √≠ndice actual
        function updateScreen() {
            if (currentIndex === 0) {
                // Volver a la pantalla de inicio
                homeScreen.classList.add('active');
                contentScreen.classList.remove('active');
                navButtonsContainer.classList.remove('opacity-100');
                navButtonsContainer.classList.add('opacity-0');
                audioButtonContainer.classList.remove('opacity-100');
                audioButtonContainer.classList.add('opacity-0');
                audioButtonContainer.disabled = true;
            } else {
                // Navegar a la pantalla de contenido
                homeScreen.classList.remove('active');
                contentScreen.classList.add('active');
                navButtonsContainer.classList.add('opacity-100');
                navButtonsContainer.classList.remove('opacity-0');
                audioButtonContainer.classList.add('opacity-100');
                audioButtonContainer.classList.remove('opacity-0');
                audioButtonContainer.disabled = false;

                const data = contentData[currentIndex - 1]; // -1 porque el √≠ndice 0 es la pantalla de inicio
                displayText.textContent = data.letter;
                displayEmoji.textContent = data.emoji;
                descriptionText.textContent = data.description;
                appContainer.style.backgroundColor = data.bgColor;
            }
        }

        // Funci√≥n de navegaci√≥n
        function navigate(direction) {
            if (direction === 1) {
                currentIndex++;
                if (currentIndex > contentData.length) {
                    currentIndex = 0; // Vuelve a la pantalla de inicio
                }
            } else if (direction === -1) {
                currentIndex--;
                if (currentIndex < 0) {
                    currentIndex = contentData.length; // Vuelve al final
                }
            }
            updateScreen();
        }

        // Funci√≥n para convertir Base64 a ArrayBuffer
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        // Funci√≥n para convertir datos PCM a formato WAV
        function pcmToWav(pcmData, sampleRate) {
            const buffer = new ArrayBuffer(44 + pcmData.length * 2);
            const view = new DataView(buffer);
            let offset = 0;

            function writeString(str) {
                for (let i = 0; i < str.length; i++) {
                    view.setUint8(offset++, str.charCodeAt(i));
                }
            }

            function writeUint32(val) {
                view.setUint32(offset, val, true);
                offset += 4;
            }

            function writeUint16(val) {
                view.setUint16(offset, val, true);
                offset += 2;
            }

            // RIFF header
            writeString('RIFF');
            writeUint32(36 + pcmData.length * 2);
            writeString('WAVE');

            // fmt chunk
            writeString('fmt ');
            writeUint32(16);
            writeUint16(1); // Audio format (1 = PCM)
            writeUint16(1); // Channels (1 = mono)
            writeUint32(sampleRate);
            writeUint32(sampleRate * 2); // Byte rate
            writeUint16(2); // Block align
            writeUint16(16); // Bits per sample

            // data chunk
            writeString('data');
            writeUint32(pcmData.length * 2);
            
            // Write PCM data
            for (let i = 0; i < pcmData.length; i++) {
                view.setInt16(offset, pcmData[i], true);
                offset += 2;
            }

            return new Blob([view], { type: 'audio/wav' });
        }


        // Configuraci√≥n del bot√≥n de audio
        audioButtonContainer.addEventListener('click', async () => {
            const textToSpeak = descriptionText.textContent;
            console.log('Texto a hablar:', textToSpeak);

            audioIcon.classList.add('hidden');
            audioLoading.classList.remove('hidden');
            audioButtonContainer.disabled = true;

            const payload = {
                contents: [{
                    parts: [{ text: textToSpeak }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Zephyr" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    if (sampleRateMatch) {
                        const sampleRate = parseInt(sampleRateMatch[1], 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        
                        const audio = new Audio(audioUrl);
                        audio.play();

                        audio.addEventListener('ended', () => {
                            URL.revokeObjectURL(audioUrl);
                        });
                    }
                } else {
                    console.error('Error: No se encontraron datos de audio en la respuesta.');
                }
            } catch (error) {
                console.error('Error al generar el audio:', error);
            } finally {
                audioIcon.classList.remove('hidden');
                audioLoading.classList.add('hidden');
                audioButtonContainer.disabled = false;
            }
        });

        // Inicializa la primera pantalla al cargar
        window.onload = updateScreen;
    </script>
</body>
</html>
